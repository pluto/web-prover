name: web-prover

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]

jobs:
  web-prover-circuits:
    uses: ./.github/workflows/web-prover-circuits.yaml

  lint:
    needs: ["web-prover-circuits"]
    uses: ./github/workflows/lint.yaml
    with:
      web-prover-circuits-cache-key: ${{ needs.web-prover-circuits.outputs.cache-key }}

  build_notary:
    needs: ["web-prover-circuits"]
    uses: ./.github/workflows/build_notary.yaml
    with:
      web-prover-circuits-cache-key: ${{ needs.web-prover-circuits.outputs.cache-key }}

  build_client_native:
    needs: ["web-prover-circuits"]
    uses: ./.github/workflows/build_client_native.yaml
    with:
      web-prover-circuits-cache-key: ${{ needs.web-prover-circuits.outputs.cache-key }}

  build_client_ios:
    needs: ["web-prover-circuits"]
    uses: ./.github/workflows/build_client_ios.yaml
    with:
      web-prover-circuits-cache-key: ${{ needs.web-prover-circuits.outputs.cache-key }}

  build_client_wasm:
    needs: ["web-prover-circuits"]
    uses: ./.github/workflows/build_client_wasm.yaml
    with:
      web-prover-circuits-cache-key: ${{ needs.web-prover-circuits.outputs.cache-key }}

  test_client_wasm_origo:
    needs: ["build_client_wasm", "build_notary"]
    uses: ./.github/workflows/test_client_wasm_origo.yaml

  test_client_native_origo:
    needs: ["build_client_native", "build_notary"]
    uses: ./.github/workflows/test_client_native_origo.yaml

  test_client_native_tlsn:
    needs: ["build_client_native", "build_notary"]
    uses: ./.github/workflows/test_client_native_tlsn.yaml

  # TODO test_proofs:

  # TODO deploy:
